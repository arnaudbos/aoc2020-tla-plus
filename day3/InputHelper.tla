---- MODULE InputHelper ----
LOCAL INSTANCE Sequences
LOCAL INSTANCE Integers

const_input == <<
    "....#..#.......#........#....#.",
    "..##.#.#.#...................#.",
    "....#.#.##..#....#......#......",
    ".........#.#......##.....#.....",
    "..........#.###.##...##........",
    "#....#.#.......##.....#..#.....",
    "#...........#.#...#..#..##.##..",
    "......##.............#.....#...",
    "..##..........###..#.#..##.....",
    "...........#........#......##..",
    "..##...........##..............",
    "..#......###.#.....#.#.#.......",
    "..#..#..#..........#.#....#....",
    ".#.....##......................",
    "...#...##..#...#.........#..##.",
    ".#......#..#..#...#......#.##..",
    "..##.##.......#..#.....#..#...#",
    "..............#..#..#...#......",
    "...#...#....##.....#...#...#...",
    "......................#...#....",
    ".......#......#...#..##...#.#..",
    "##......#..#.....#....#.....#..",
    "....#.#.##.#.#....#............",
    "#.....##.............#.........",
    "..........#...........#.#.....#",
    "...#...##....#.#........#..#...",
    "................#..#.##.##....#",
    "......#...#...##...##....#.....",
    "##....#..#..#...#..#...........",
    "#..................#...#.#..#..",
    "....##....##.#....#..#......#..",
    ".....#...........#.........##..",
    "..#..............#.........#..#",
    "......##....................#..",
    "..#.....###...####...#...#.##..",
    "#..#.#......#.....#.......#.#..",
    "##.#.........######........#...",
    "..#....###...#.#..............#",
    ".....#..............#.........#",
    "....#......#..#.........#...#..",
    ".....###.....#.###.......###...",
    "#.#..#.....#....##...#........#",
    "..##....#..#.........#...#.#...",
    "..#..##.............#....#.#.#.",
    "..##.#..#.#.#.........##.......",
    "#.#..#.........#..............#",
    "#..#.........###.......#.#..#.#",
    ".............#...#....#......#.",
    "..........#.#...##.###.....#.#.",
    "..#.....#......................",
    ".......#......###.#.......#....",
    "....#....#.........#...###.#.#.",
    ".#.............#............#..",
    "....#..#.............#.#....#..",
    "....#.....#...#...##.#.........",
    "..#...#...#..................#.",
    "........#....#.....#...........",
    ".....##.......#...#.#..#..#....",
    "...#............#..#.#.........",
    "......................#........",
    "....#......#.....#.#....#......",
    ".....#..#.........#.........##.",
    "...............#.....#....##...",
    "...#.#.#...#..#...........#....",
    ".#....###......##...#.#.#.#....",
    ".....#...#....####....##.......",
    "..#......#..#.....##.#...#.....",
    "...#.##..#....#..##.....#......",
    "..#......#...#...##.....#...#..",
    "......#.....#........#.........",
    "..#.#....#..............##....#",
    "..#...#......##............#...",
    ".##.#.......#.......#......#..#",
    "...##.##...#.....#.......#..#..",
    "......##..#....#.......#.......",
    ".....#..#..#.#.....#.....#...##",
    "##.#...#.#.#.....#...#.#.#.##.#",
    "...................###...#..#..",
    ".#.....##.#......#........#....",
    ".##...##.#..........#...#....#.",
    "......#..............#.#......#",
    "...#.......#..#...........#....",
    ".###...#............##..#...##.",
    "##..#.#.........#............#.",
    "#...#.#......#.##...........#.#",
    ".#.#...#........#......##......",
    "....#...#...#.....#...#....#...",
    "...##...........##.........#...",
    ".........#...#..###............",
    "..#........#...............#...",
    ".............#....#.#..........",
    "........#......#.#.......#....#",
    ".................#....##.#.##..",
    "..#...##........#..............",
    "#..#........#...#....#.........",
    "......#.#.....#.....#..###.#..#",
    "....#............#...#.#.#.....",
    "............#..........#...#...",
    "..........#....##.#.........#..",
    "..............#...#...#..#.....",
    "#......#....#..##....#......##.",
    "...#....#.................#....",
    ".#.##.............#...#....##..",
    "....#..#.........#..#....#....#",
    "..#.....##..#......#.#..#......",
    "..#..#.....#........#...#..#..#",
    ".........##.#.##.#.......#....#",
    "..#.......##.##...#.....#.....#",
    ".............##...#...........#",
    "..#......#..#....#...#..#.##...",
    "....#........#......#.........#",
    ".......#........#..#.#.#..##..#",
    "..#......#...........##...#....",
    ".....#..#.#...#..............##",
    ".#..#......#......#........#..#",
    "...##...............#....#.....",
    ".......#...#.......##..#.......",
    ".....#....#...#...#..#.....#.#.",
    "...#.........#.....#...........",
    "...#.....###....#....#...#...#.",
    "#..#.....#.........#.........#.",
    ".................#.#.....#....#",
    "...........#..........#..#.....",
    "........#.#....#...#..#.....###",
    "#............................#.",
    "..##..#..#...##.........#......",
    "......##....#.#...#.........#..",
    "......#..##.#......#..#.....#..",
    "...#.......##....#.#....#......",
    ".....#........#...#............",
    "#.......#...#.........#......#.",
    "......#......#....#..#.........",
    "..#.#........#..#......#....#..",
    ".#..#.#..........##....###.#..#",
    "...#....#.##..#...#....#.......",
    "..#.....#......#.###.......#...",
    "..............................#",
    ".....#..#...#...........#......",
    ".##...#....##....#.#.#.#....#.#",
    ".#...#....#...#........#.......",
    "....#............#...##..#.....",
    "....##..#....#....#.....#....##",
    ".............#..##.#.#.#.......",
    "#.......#.#.#.......#..#..#....",
    "#..#...........#.......###..#..",
    ".#..##.#.....#........#........",
    "..#.#.......#............#..#..",
    "...........#..#............##.#",
    ".....#.......#.....#..#.##.#..#",
    "......#......##.....##.........",
    "..##.#..#.#..#..#..............",
    ".....#.............##...#.#.##.",
    ".#......##.#..........#........",
    "..#..#.........#.....#.#.#.....",
    "..#.....#.......#.....#..#.....",
    "#.#.#........#.#...#....#..#...",
    ".#.#.......#............#....#.",
    "......#..................#....#",
    ".#...#...#.....#.#..........#..",
    ".#..##....####...........#.#...",
    "..##.....#...#.#....#....#.....",
    "#.....................#....#.#.",
    "###..###.#.#...........#.....##",
    "......#......#..........#......",
    "...#......#.##.....#......###.#",
    ".............#..#.#...........#",
    "..#.............#.#..#.....#...",
    "...#...............#....##...##",
    "........#.................#....",
    "#..###.....#.......##.#......##",
    "....#.#..............#.........",
    "#..........#.....#..##...#.....",
    "................#...#..#....#..",
    "..#...#....##..........#.#.....",
    "......#........##......#..#...#",
    "...#....#..#.....#.......#...#.",
    ".#.....#..#...#..###....#......",
    "....#.........#....#.#.#.....#.",
    "#.#....#...#....#.....#..##....",
    ".......#..#..#..........#...#..",
    "..#.#..#.....##.#.#............",
    "..#....#.....#..##..#..#.#..#..",
    "..#.##.#...........#...#..#....",
    ".........#........#...#........",
    "..#.#.#.......##.........#.##..",
    "#.#..........#.#...#..#......##",
    ".#..#....................#.#...",
    ".##......#................#...#",
    "..##.#######......#....#.......",
    "....#...##.#....#.#............",
    ".##....#...##.......#...#..#...",
    "...........#...#...#...#..#....",
    "#...#.....#.......#....#.....#.",
    ".............#.................",
    "........#.#.......#...#.#.#....",
    "..............#............#.#.",
    "......#......##..#.......#....#",
    "##...#..................#......",
    ".....#......###.....#.......#.#",
    ".....#.#............#.#........",
    "..#.#..#............#....#.#...",
    "##.#.###.#.#.#..#......#.......",
    "...##........#..#.....#.#.#..#.",
    "##......#.##.....####..#.......",
    "............#...#..#...#..#....",
    "...#..#................##.#..#.",
    ".#....#.#...........##.#.#...#.",
    "####..#...........#.......###..",
    ".......#.................#.....",
    ".......#....#.......##....#....",
    "..#.........#...#....#.........",
    "..........#..#...#.#...##..#...",
    "....##..........#.........##...",
    "#.........##..#.#..#.......#...",
    ".#...........#....#...#...#.#..",
    "....#..#.....#...##....#.#....#",
    ".#....#.....#......#..##.##.#.#",
    "#......#..#.......##...........",
    "...#..#...#.#.................#",
    "......#.......##....##.#......#",
    "....#....#.#.#.....#....#....#.",
    "..#..........#.##...##..#......",
    "...#..#........#....#.#..#....#",
    "##.......#........#..........#.",
    ".#........#.......#...#..##...#",
    "..#..#..##..#...........#...###",
    "..#......#..........#..##......",
    ".#.....#..#.#...#...#.........#",
    "#.#......##....................",
    "#...#.....##...........#.......",
    "........#...#....#.......##....",
    "...#.##...#....#....#..#..#..#.",
    "...#..#......##....#..#..##....",
    "#...#..........#.#.............",
    "##..#........##.....#.........#",
    ".....#......#.#...###..#.......",
    "#..##.#..#.###...........##..#.",
    ".....#....#..........#.......#.",
    "##.........##.#................",
    "....#.........#............##..",
    ".......#........#......#..#..##",
    ".#...#...##..#....#..#.........",
    ".............#...#.#........#..",
    "......#..#...#..#.###..#.......",
    "........##.#..#.#..#..#........",
    "#.##..#..#..........#...##..###",
    ".##...#............#.#...##..#.",
    "................#....##.#...#..",
    "#.................#..........#.",
    "...#..#..#.....................",
    "..#...##.#.#...................",
    ".....#...#.......#............#",
    "..#..#.........#..##.#..#.#...#",
    ".....#.#.....#.#.......#.....#.",
    "..................#..#....#.#..",
    "..#.....###.##.......##....#.#.",
    "..#......##.......#....##.#....",
    "....#...................#..##.#",
    ".......#....#.##.#.......#....#",
    "..#...#......#..#...###....#.#.",
    "..#..#.#....#...........#.....#",
    ".....#..#..#.......#........#..",
    "......#.##.#......#...........#",
    "#...#....#.#..##.##..#..##.....",
    "#...##....#.#...##........#....",
    "..##............#.#.#..........",
    "....#.....#.#..#.......#..#....",
    "#..#.#.....#..#..##...#..##....",
    "...##........#...........#...#.",
    ".####......#..##.........#.#...",
    ".......#.......................",
    ".................#....#..#.....",
    ".........##......###...........",
    ".##......#.#.#....#.#...#..###.",
    "....#......##.###.#.#..#.......",
    "..........#.......##......##..#",
    "...........#.......#..##.......",
    ".....###..#..............##....",
    "........##..#.#.#......#....#..",
    "#....#.........................",
    "...........#...............##..",
    "......#.................#......",
    ".....#...#..##...##...#...#....",
    "..........#.#...##.####......#.",
    "..#.#.....##....#...........#..",
    "..........#....#..#....##...#..",
    ".#.......#..##...#...#.....#...",
    "...##....#.#......##...##....#.",
    "#.......#.......#.##.#...#.#...",
    "#...#..................#......#",
    "..#.......#...............#..##",
    "#.....#..................#....#",
    ".##.....#.....#......####.....#",
    "..#........#...#.#........#...#",
    "..##.....#....#...#...........#",
    "..#..#.....##..#.##...#........",
    "..........###..#....##.....#...",
    "...#...#....#.##.#...#.#.......",
    "..##......#.......#.......##...",
    "............#............#.....",
    ".##....#.........#.............",
    "....#....#....#........##...#.#",
    ".......##......................",
    "..........#.#.................#",
    "......##.#...#.........#.....#.",
    "..#...#......#..#.............#",
    "..........###.#..#.#...#..#..#.",
    "#..#.#..#....##...#...#.#...#..",
    ".#........##...#......#.##.....",
    "...###.#...##..............##..",
    "#.#.#...#...#..#....#.#..#.....",
    ".#.#.##..#....#......#.#.......",
    "...#..#.#....##...........#..#.",
    ".....##..##......#.#...........",
    "......#.....#....####....#.....",
    ".#.#.#...#..#..#...........#...",
    ".....#......................#..",
    ".........#.........#.###.##....",
    ".....#......##..........#......",
    "..#...........##...........#...",
    "..............#.........#.....#",
    "..#....#..#...#...##.#.........",
    ".#.#.#....#..........#........."
>>

IsOpen(c) == c = "."

IsaTree(c) == c = "#"

RECURSIVE ValidRowAux(_,_)
ValidRowAux(row, isValid) ==
    IF Len(row) = 0 \/ ~isValid
    THEN isValid
    ELSE ValidRowAux(Tail(row), IsOpen(Head(row)) \/ IsaTree(Head(row)))

ValidRow(row) ==
    ValidRowAux(row, TRUE)

\* expr == ValidRow("...#..")

RECURSIVE SubStringAux(_,_,_,_)
SubStringAux(str,acc,from,take) ==
    IF Len(str) = 0
    THEN acc
    ELSE IF from > 0
         THEN SubStringAux(Tail(str), acc, from - 1, take)
         ELSE IF take > 0
              THEN SubStringAux(Tail(str), acc \o Head(str), from, take - 1)
              ELSE SubStringAux(<<>>, acc \o Head(str), from, take)

SubString(str,from,to) ==
    SubStringAux(str, "", from-1, to - from)

\* expr == SubString("sample", 4, 4)

CharAt(row, index) ==
    SubString(row, index, index)

====